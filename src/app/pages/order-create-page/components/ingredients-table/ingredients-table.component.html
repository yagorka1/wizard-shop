<div class="flex items-center justify-center min-h-screen p-4">
  <p-card class="mb-0 w-full max-w-[1200px] rounded-xl relative">
    <ng-template pTemplate="header">
      <div class="flex items-center justify-between w-full p-6">
      <span class="text-xl font-semibold">
       {{ 'ingredientsTable.title' | translate }}
      </span>

        <p-button
          severity="secondary"
          [label]="'ingredientsTable.back' | translate"
          (onClick)="goBack()"
          styleClass="mb-4"
        />
      </div>
    </ng-template>

    <ng-container [formGroup]="form">
      <p-table [value]="ingredientsControls" [tableStyle]="{'min-width': '60rem'}" class="h-[50vh] overflow-y-auto">
        <ng-template pTemplate="header">
          <tr>
            <th style="width:5%">{{ 'ingredientsTable.table.select' | translate }}</th>
            <th style="width:20%">{{ 'ingredientsTable.table.name' | translate }}</th>
            <th style="width:12%">{{ 'ingredientsTable.table.rarity' | translate }}</th>
            <th style="width:25%">{{ 'ingredientsTable.table.effect' | translate }}</th>
            <th style="width:12%">{{ 'ingredientsTable.table.pricePer100g' | translate }}</th>
            <th style="width:15%">{{ 'ingredientsTable.table.percent' | translate }}</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-group let-ri="rowIndex">
          <tr [formGroup]="group" [class.bg-green-50]="group.get('selected')?.value">
            <td class="align-middle">
              <p-checkbox
                formControlName="selected"
                [binary]="true"
                (onChange)="onSelectionChange(ri)"
              />
            </td>

            <td class="align-middle font-medium">
              {{ 'ingredients.' + group.get('id')?.value + '.name' | translate }}
            </td>

            <td class="align-middle">
              <span 
                class="px-2 py-1 rounded text-xs font-medium"
                [ngClass]="getRarityClass(group.get('rarity')?.value)"
              >
                {{ 'rarity.' + group.get('rarity')?.value | translate }}
              </span>
            </td>

            <td class="align-middle text-sm text-gray-600">
              {{ 'ingredients.' + group.get('id')?.value + '.effect' | translate }}
            </td>

            <td class="align-middle">
              {{ group.get('price')?.value | number:'1.2-2' }} {{ 'currency' | translate }}
            </td>

            <td class="align-middle">
              <div class="input-wrapper" style="min-height: 32px;">
                @if (group.get('selected')?.value) {
                  <app-input formControlName="percent" placeholder="%" type="number"></app-input>
                } @else {
                  <div class="h-8 flex items-center">
                    <span class="text-gray-400">â€”</span>
                  </div>
                }
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </ng-container>

    <div class="mt-6 p-4 bg-gray-100 rounded-lg">
      <div class="flex justify-between items-center flex-wrap gap-4">
        <span class="font-medium">{{ 'ingredientsTable.summary.selectedIngredients' | translate }}: {{ selectedIngredients.length }}</span>
        <span class="font-medium" [class.text-green-600]="totalPercent === 100" [class.text-red-600]="totalPercent !== 100">
          {{ 'ingredientsTable.summary.totalPercent' | translate }}: {{ totalPercent }}%
        </span>
        <span class="font-medium text-blue-600">
          {{ 'ingredientsTable.summary.total' | translate }}: {{ totalPrice | number:'1.2-2' }} {{ 'currency' | translate }}
        </span>
      </div>
    </div>

    @if (tableErrors.length > 0) {
      <div class="mt-4 p-4 bg-red-100 rounded-lg text-red-700">
        <ul class="list-disc pl-5">
          @for (error of tableErrors; track error) {
            <li>{{ error }}</li>
          }
        </ul>
      </div>
    }

    @if (canSaveOrder) {
      <p-button
        severity="success"
        class="block mt-6"
        [label]="'ingredientsTable.placeOrder' | translate"
        [disabled]="isDisableButton"
        icon="pi pi-check"
        (onClick)="save()"
      />
    }
  </p-card>
</div>
